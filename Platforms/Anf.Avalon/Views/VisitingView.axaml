<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Anf.Avalon.ViewModels"
             xmlns:s="using:Avalonia.Controls.PanAndZoom"
             xmlns:kwc="using:Anf"
             x:Name="VisitingView"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Anf.Avalon.Views.VisitingView">
  <Design.DataContext>
    <vm:AvalonVisitingViewModel/>
  </Design.DataContext>
  <Grid>
    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
      <ItemsRepeater Name="Rep" Background="{x:Null}" Items="{Binding Resources}">
        <ItemsRepeater.ItemTemplate>
          <DataTemplate>
            <Grid>
              <Border IsVisible="{Binding LoadSucceed}">
                <Border.ContextMenu>
                  <ContextMenu>
                    <MenuItem Header="保存" CommandParameter="{Binding}" Command="{Binding DataContext.SaveImageCommand,ElementName=Rep}"></MenuItem>
                    <MenuItem Header="重载" Command="{Binding ReLoadCommand}"/>
                  </ContextMenu>
                </Border.ContextMenu>
                <Image Stretch="None" Source="{Binding Resource}" MinHeight="200"></Image>
              </Border>
              <StackPanel IsVisible="{Binding HasException}" Orientation="Vertical">
                <TextBlock VerticalAlignment="Center" Text="{Binding Exception}" TextWrapping="Wrap" MaxHeight="400">
                  <ToolTip.Tip>
                    <TextBlock Text="{Binding Exception}"/>
                  </ToolTip.Tip>
                </TextBlock>
                <Button MaxWidth="200" Content="Reload" Command="{Binding LoadCommand}" Margin="0,10,0,0"/>
              </StackPanel>
              <StackPanel IsVisible="{Binding Loading}" Orientation="Vertical">
                <ProgressBar IsIndeterminate="True" Margin="20,0"/>
              </StackPanel>
            </Grid>
          </DataTemplate>
        </ItemsRepeater.ItemTemplate>
      </ItemsRepeater>
    </ScrollViewer>

    <Border VerticalAlignment="Bottom" HorizontalAlignment="Left" Grid.RowSpan="2" Background="Gray" Padding="8,4" CornerRadius="8" Margin="4,8">
      <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
        <StackPanel.Resources>
          <Style x:Key="Tbx" Selector="TextBlock">
            <Setter Property="FontSize" Value="10"/>
          </Style>
        </StackPanel.Resources>
        <TextBlock Text="{Binding CurrentChapter.Title}"/>
        <TextBlock>(</TextBlock>
        <TextBlock Text="{Binding CurrentPageCursor.CurrentIndex}"></TextBlock>
        <TextBlock>/</TextBlock>
        <TextBlock Text="{Binding CurrentPageCursor.Count}"></TextBlock>
        <TextBlock>)</TextBlock>
      </StackPanel>
    </Border>
    
    <Border Grid.RowSpan="2" IsVisible="{Binding IsLoading}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
      <ExperimentalAcrylicBorder>
        <ExperimentalAcrylicBorder.Material>
          <ExperimentalAcrylicMaterial TintColor="Blue" MaterialOpacity="0.8" TintOpacity="0.87" />
        </ExperimentalAcrylicBorder.Material>
        <StackPanel Orientation="Vertical" VerticalAlignment="Center" Margin="20,0">
          <StackPanel.Resources>
            <Thickness x:Key="ItemMargin">0,20,0,0</Thickness>
          </StackPanel.Resources>
          <Image Height="300" Source="{Binding LogoImage}" HorizontalAlignment="Center" Margin="{StaticResource ItemMargin}"/>
          <TextBlock FontSize="22" Text="{Binding Name}" HorizontalAlignment="Center" Margin="{StaticResource ItemMargin}"/>
          <ProgressBar IsIndeterminate="True" HorizontalAlignment="Stretch" Margin="{StaticResource ItemMargin}"/>
        </StackPanel>
      </ExperimentalAcrylicBorder>
    </Border>
  </Grid>
</UserControl>
