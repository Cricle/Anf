<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Anf.Avalon.ViewModels"
             xmlns:m="using:Anf.Avalon.Models"
             xmlns:kwce="using:Anf"
             xmlns:paz="using:Avalonia.Controls.PanAndZoom"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             Background="Transparent"
             x:Class="Anf.Avalon.Views.HomePage">
  <Design.DataContext>
    <vm:AvalonHomeViewModel></vm:AvalonHomeViewModel>
  </Design.DataContext>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>
    <Grid Margin="20,0,20,6">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>
      <AutoCompleteBox HorizontalAlignment="Stretch" Watermark="Search" IsEnabled="{Binding Searching,Converter={StaticResource RevBoolConverter}}" Text="{Binding Keyword,Mode=TwoWay}">
        <AutoCompleteBox.KeyBindings>
          <KeyBinding Command="{Binding SearchCommand}" Gesture="Enter"/>
        </AutoCompleteBox.KeyBindings>
      </AutoCompleteBox>
      <Button Grid.Column="1" VerticalAlignment="Stretch" Background="Transparent" Padding="16,8" Command="{Binding SearchCommand}" IsEnabled="{Binding Searching,Converter={StaticResource RevBoolConverter}}" >
        <TextBlock Text="&#xE71E;" Classes="segoblock" VerticalAlignment="Center"></TextBlock>
      </Button>
    </Grid>
    <ProgressBar Grid.Row="1" IsVisible="{Binding Searching}" IsIndeterminate="True">

    </ProgressBar>
    <Border Grid.RowSpan="4" IsVisible="{Binding EmptySet}">
      <StackPanel Orientation="Horizontal" VerticalAlignment="Center"
                  HorizontalAlignment="Center">
        <TextBlock FontSize="22" Text="可以从上方输入框输入"/>
        <TextBlock FontSize="22" FontWeight="ExtraBlack" Text="关键字"/>
        <TextBlock FontSize="22" Text="搜索或直接输入"/>
        <TextBlock FontSize="22" FontWeight="ExtraBlack" Text="可解析"/>
        <TextBlock FontSize="22" Text="漫画网址"/>
      </StackPanel>
    </Border>

    <ListBox Grid.Row="2" Background="{x:Null}" Items="{Binding Snapshots}" SelectionMode="Single" VirtualizationMode="Simple" SelectedItem="{Binding CurrentComicSnapshot,Mode=TwoWay}" IsVisible="{Binding EmptySet,Converter={StaticResource RevBoolConverter}}">
      <ListBox.ItemsPanel>
        <ItemsPanelTemplate>
          <WrapPanel Orientation="Horizontal"/>
        </ItemsPanelTemplate>
      </ListBox.ItemsPanel>
      <ListBox.ItemTemplate>
        <DataTemplate DataType="{x:Type m:AvalonComicSnapshotInfo}">
          <Grid>
            <Grid.ContextMenu>
              <ContextMenu>
                <MenuItem Header="打开">
                  <MenuItem Header="从浏览器"/>
                  <MenuItem Header="从文件夹"/>
                </MenuItem>
                <MenuItem Header="复制"></MenuItem>
              </ContextMenu>
            </Grid.ContextMenu>
            <ToolTip.Tip>
              <StackPanel Orientation="Vertical">
                <TextBlock Text="{Binding Snapshot.Descript,Mode=OneTime}"/>
                <ItemsRepeater Items="{Binding SourceInfos}" Margin="0,4,0,0">
                  <ItemsRepeater.Layout>
                    <StackLayout Orientation="Horizontal"/>
                  </ItemsRepeater.Layout>
                  <ItemsRepeater.ItemTemplate>
                    <DataTemplate DataType="{x:Type kwce:ComicSource}">
                      <Border Padding="4,2" CornerRadius="3" Background="Gray" Margin="0,0,2,0">
                        <TextBlock Text="{Binding Source.Name}"/>
                      </Border>
                    </DataTemplate>
                  </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
              </StackPanel>
            </ToolTip.Tip>
            <Image Source="{Binding LogoImage,Mode=OneWay}" Width="300"/>
            <Border Background="#A1666666"
                                VerticalAlignment="Bottom">
              <TextBlock Text="{Binding Snapshot.Name,Mode=OneTime}"
                         FontSize="16"
                         Margin="0,16"
                         HorizontalAlignment="Center"/>
            </Border>
          </Grid>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
  </Grid>
</UserControl>
